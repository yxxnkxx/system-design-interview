# 7장 분산 시스템을 위한 유일 ID 생성기 설계

## 요구사항
- ID는 유일하다
- 숫자로만 구성
- 64비트로 표현
- 발급 날짜에 따라 정렬 가능해야 한다
- 초당 10,000개의 ID를 발급할 수 있어야 한다

## 개략적 설계

선택지
- 다중 마스터 복제
- UUID
- 티켓 서버
- 트위터 스노플레이크 접근법

### 다중 마스터 복제

데이터베이스의 auto_increment 기능 활용

**k만큼 증가, k=데이터베이스 서버의 수**

단점
- 여러 데이터 센터에 걸쳐 규모를 늘리기 어려움
- ID가 순서대로 증가하지 않음
- 서버를 추가/삭제할 때도 잘 동작하지 않음

### UUID

UUID: 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위해 사용되는 128비트 숫자

**장점**

- 단순, 서버 사이의 동기화가 필요 없음
- 규모 확장이 쉬움

**단점**

- 128비트로 크기가 큼
- 시간순 정렬 x
- 숫자로만 구성되지 않음

### 티켓 서버

auto_increment 기능을 사용하여 ID를 생성하는 서버를 중앙 집중형으로 하나만 사용

**장점**
- 유일성이 보장되는 ID를 생성할 수 있음
- 구현하기 쉬움, 중소 규모 시스템에 적합

**단점**
- 티켓 서버가 SPOF가 됨

### 트위터 스노플레이크 접근법
64비트 ID 구조
- 1비트: 부호 비트
- 41비트: 타임스탬프
- 5비트: 데이터 센터 식별자
- 5비트: 서버 식별자
- 12비트: 시퀀스 번호
  - 같은 서버에서 같은 시간에 생성된 ID가 중복되지 않도록 하는 역할
  - 1밀리초마다 0으로 초기화

## 상세 설계

### 타임스탬프

시간순 정렬
- 41비트로 69년간의 시간을 표현 가능

### 일련번호

12비트로 1밀리초당 4096개의 ID를 생성 가능

